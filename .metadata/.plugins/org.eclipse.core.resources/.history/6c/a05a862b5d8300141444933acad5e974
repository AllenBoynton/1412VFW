// Global variables
var pWidth = Ti.Platform.displayCaps.platformWidth,
	pHeight = Ti.Platform.displayCaps.platformHeight,
	itemCount = 30,
	rowCount = 4,
	margin = 5,
	canvasWidth = pWidth - margin * (rowCount + 1),
	size = canvasWidth / rowCount,
	imagesFolder = Ti.Filesystem.getFile(Ti.Filesystem.resourcesDirectory, "images"),
	imageFiles = imagesFolder.getDirectoryListing()
;

// Function for new gallery window
var getGallery = function(){
	var makeWindow = Ti.UI.createWindow({
		backgroundColor: "gray"
	});
	
	// Gallery bar
	var titleBar = Ti.UI.createView({
		backgroundColor: "white",
		top: 20,
		height: 50
	});
	
	//Gallery bar text
	var titleText = Ti.UI.createLabel({
		text: "Underwater Doggies",
		color: "gray",
		textAlign: "center",
		font: {fontFamily: "Chalkduster", fontSize: 16, fontWeight: "bold"}
	});
	
		// Close button
	var exitButton = Ti.UI.createLabel({
		text: "Return To Gallery",
		backgroundColor: "gray",
		color: "#000",
		height: 50,
		font: {fontFamily: "Chalkduster", fontSize: 16},
		width: "100%",
		bottom: 0,
		textAlign: "center"
	});

	// Border
	var border = Ti.UI.createView({
		backgroundColor: "gray",
		top: titleBar.top + titleBar.height,
		height: 2
	});
	
	// Container for images
	var container = Ti.UI.createScrollView({
		top: titleBar.top + titleBar.height + border.height, 
		width: pWidth,
		contentWidth: pWidth,
		height: pHeight - titleBar.top - titleBar.height - exitButton.height,
		showVerticalScrollIndicator: true,
		backgroundColor: "gray",
		layout: "horizontal"
	});

	// For loop to cycle through images in master image file
	for(var i=0; i<imageFiles.length; i++){
		var thumbnail = Ti.UI.createView({
			backgroundColor: "#33CCFF",
			top: margin,
			left: margin,
			width: size,
			height: size,
			borderRadius: 5
		});
		
		var newImage = Ti.UI.createImageView({
			image: "images/" + imageFiles[i],
			top: 0,
			width: thumbnail.width*2,
			borderRadius: 5
		});
		
		thumbnail.add(newImage);
		container.add(thumbnail);
		
		// Event listener for images
		container.addEventListener("click", function(event){
			getPicture(event.source.image);
		});
		
		// Exit window
		var exitWindow = function(){
			makeWindow.close();
		};
		
		// Main code to return
		exitButton.addEventListener("click", exitWindow);
		
		titleBar.add(titleText);
		makeWindow.add(titleBar, border, container, exitButton);
		makeWindow.open();
	};
};

// Function to open gallery window
var getPicture = function(dataSource){
	var picWindow = Ti.UI.createWindow({
		backgroundColor: "#595959"
	});
	
	// Title bar
	var titleBar = Ti.UI.createView({
		backgroundColor: "#333333",
		top: 20,
		height: 50
	});
	
	// Title bar text
	var titleText = Ti.UI.createLabel({
		text: "Pictures",
		color: "#fff",
		textAlign: "center",
		font: {fontFamily: "Chalkduster", fontSize: 16, fontWeight: "bold"}
	});
	
	// Photo view
	var newImage = Ti.UI.createImageView({
		image: dataSource,
		top: 150,
		left:10,
		right: 10,
		borderRadius: 5
	});
	
		// Exit button
	var closeButton = Ti.UI.createLabel({
		text: "Close Gallery",
		backgroundColor: "gray",
		color: "white",
		height: 50,
		font: {fontFamily: "Chalkduster", fontSize: 16},
		width: "100%",
		bottom: 0,
		textAlign: "center"
	});

	var picLabel = Ti.UI.createLabel({
		text: dataSource,
		bottom: 100,
		textAlign: "center",
	});
	
	// Border
	var border = Ti.UI.createView({
		backgroundColor: "#000",
		top: titleBar.top + titleBar.height,
		height: 2,
	});
		
	// Close window
	var closeWindow = function(){
		picWindow.close();
	};
	
	// Main code for photos
	closeButton.addEventListener("click", closeWindow);
	titleBar.add(titleText);
	picWindow.add(titleBar, border, closeButton, picLabel, newImage);
	picWindow.open();
};

menuButton.addEventListener("click", getGallery);
	